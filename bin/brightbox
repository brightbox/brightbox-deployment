#!/usr/bin/env ruby

begin
  require 'rubygems'
rescue LoadError
  # no rubygems to load, so we fail silently
end

require 'optparse'

@options = {}
OptionParser.new do |opts|
  opts.banner = "The brightbox command sets up your Rails application for deployment\n"
  opts.banner << "Usage: #{$0} [options] [args]"

  opts.on("-ADIRECTORY", "--apply-to DIRECTORY",
    "Create a minimal set of scripts and recipes",
    "for use with capistrano to configure servers."
  ) { |value| @options[:apply_to] = value }
  
  opts.on("-nAPPLICATION_NAME", "--name APPLICATION_NAME",
    "Name of application (a short useful name for the app such as 'myforum')"
  ) { |value| @options[:application] = value }
  
  opts.on("-dDOMAIN_NAME", "--domain DOMAIN_NAME",
    "Domain name for application (e.g: www.example.com)"
  ) { |value| @options[:domain] = value }
  
  opts.on("-iSERVER_NAME", "--server SERVER_NAME",
    "Hostname or IP address of your Brightbox virtual server (e.g: example-001.vm.brightbox.net)"
  ) { |value| @options[:server] = value }
 
  if ARGV.empty?
    puts opts
    exit
  else
    opts.parse!(ARGV)
    if @options[:apply_to].nil? or @options[:application].nil? or @options[:domain].nil? or @options[:server].nil?
      puts "All arguments are required"
      exit 1
    end
  end
end

require 'brightbox/generators/loader'
Brightbox::Generators::RailsLoader.load! @options
